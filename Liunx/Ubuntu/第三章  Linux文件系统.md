# 第三章  Linux文件系统

​	文件系统是操作系统用于确定磁盘或分区上的文件的方法和数据结构，即文件在磁盘上的组织方法。文件系统由3部分组成：与文件管理有关的软件、被管理的文件以及实施文件管理所需的数据结构。



## 1.Ubuntu的文件系统

​	文件系统负责为用户建立、保存、读出、修改、转储文件，控制文件的读取，当用户不再使用时删除文件等。磁盘或分区和它所包含的文件系统的种类有很大关系。少数程序基于特定文件系统进行操作，在其他类型的文件系统中不能工作。一个分区或磁盘作为文件系统使用前，需要进行初始化，并将记录数据结构写到磁盘上，这个过程就称为**文件系统的建立**。下面介绍几种常见的文件系统类型：

- **FAT文件系统**

  FAT，全称File Allocation Table，即文件分配表，最早于1982年开始应用于MS-DOS中。FAT可允许Windows3-9x、MS-DOS等操作系统访问。FAT文件系统也是一种最初用于小型磁盘和简单文件夹结构的简单文件系统，用文件分配表映射和管理磁盘空间。它专门为单用户操作系统开发的，不保存文件的权限信息，除了隐藏、只读等公共属性以外，不具备高级别安全防护措施。FAT最大只支持2GB，FAT32可达到2047GB.

- **NTFS文件系统**

   NTFS，全称New Techanology File System，新技术文件系统，最早用于Windows NT/2000操作系统的文件系统。它支持文件系统故障恢复，尤其是大存储量的媒体和长文件名。NTFS是一个高度可靠、可恢复的文件系统，提供了FAT文件系统所没有的安全性、可靠性和兼容性。它提供了加密功能，大大提高了信息的安全性，可以赋予单个文件和文件夹访问权限，在NTFS分区上，可以为共享资源、文件夹以及文件设置访问权限。

  NTFS相较于FAT能更有效的利用磁盘空间，虽然NTFS文件可以读取FAT文件系统和HPFS（High Performance File System，高性能文件系统）文件系统的文件，但是不能被它们所读取，因此兼容性较差。



​	Linux操作系统采用的文件系统一般为Ext2、Ext3、Ext4等。Ext是Extended File System的缩写，意为扩展的文件系统。Linux作为开源的操作系统，其也可以支持FAT32和NTFS，**如果用户想在Linux操作系统中使用非Linux文件系统，就必须在操作系统中挂载这些文件系统到Linux内核中**。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202308262230988.png" alt="image-20230826222957844" style="zoom:50%;" />

​	Linux文件系统各分层之间的功能：

- **设备驱动程序**：文件系统利用存储设备存储文件，因此，存储设备是文件系统的物质基础。Linux系统中各设备驱动程序都通过统一的接口与文件系统连接，文件系统向用户提供使用文件系统的接口，设备驱动程序则控制设备实现具体的文件I/O操作。
- **实际文件系统：**实际文件系统是以磁盘分区来划分的，每个磁盘分区由一个具体的文件系统管理，不同磁盘分区的文件系统可以不同。Linux默认的文件系统是Ext2、Ext3、Ext4.
- **虚拟文件系统：**Linux为了屏蔽各文件系统之间的差别，为用户提供访问文件的统一接口，在具体的文件系统之上增加了一个称为虚拟文件系统(Virtual File System,VFS)的抽象层。VFS是Linux对外接口，任何要使用文件系统的程序都必须经由这个接口来使用它。VFS是一个异构文件系统之上的软件粘合层。

​       VFS的原理示意图：

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202308262238190.png" alt="image-20230826223852099" style="zoom:50%;" />

​	有了VFS，用户察觉不到文件系统之间的差异，可以使用同样的命令和系统调用来操作系统不同的文件系统，并可以在它们之间自由的复制文件。**VFS的作用就是采用标准的Linux系统调用读写位于不同物理介质上的不同文件系统中的文件**。

- **缓存机制：**文件系统和存储设备进行数据传输时，采用缓存机制来提高存储设备的访问效率。缓存区实在内存中划分的特定区域，每次从外部设备读取的数据都暂时存放在这里。下次读取时首先搜索缓存区。如果缓存区没有，则再启动存储设备，读取相应的数据。写入的数据也要先存放在缓存区，然后再分批写入磁盘中。